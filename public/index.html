<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="description" content="homepage">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>summer 2020</title>
    <style>
      .canvasframe {
        float: left;
        width: 620px;
      }
      .chatframe {
        float: right;
        width: 350px;
      }
      .row:after {
        content: "";
        display: table;
        clear: both;
      }
    </style>
</head>
<body>
    <div class='row'>
        <div class="canvasframe">
            <label>Event Log</label>
            <br>
            <textarea id="eventlog" rows="30" cols="150" style="border: 1pt solid black;" disabled></textarea>
            <br>
            <div class="day-options">
                <form>
                    <label>Day</label><br>
                    <input id="day-leave" type="button" onclick="button_day('leave')" value="Leave"></input>
                    <label>or</label>
                    <input id="day-stay" type="button" onclick="button_day('stay')" value="Stay"></input>
                    <br>
                    <input id="day-proceed" type="button" onclick="button_proceed()" value="Proceed to Night"></input>
                </form>
            </div>
            <br>
            <div class="night-options">
                <form>
                    <label>Night</label><br>
                    <input id="night-stay_awake" type="button" onclick="button_night('awake')" value="Stay Awake"></input>
                    <br>
                    <input id="night-stab" type="button" onclick="button_night('stab')" value="Stab"></input>
                    <label>or</label>
                    <input id="night-tape" type="button" onclick="button_night('tape')" value="Tape"></input>
                    <select id="player-select"></select>
                </form>
            </div>
        </div>
        <div class="chatframe">
            <form>
                <label>Participants</label><br>
                <textarea id="participants" rows="10" cols="50" disabled></textarea><br>
                <label>Chat</label><br>
                <textarea id="chatbox" rows="31" cols="50" disabled></textarea><br>
                <input type="text" id="text" size="43"></input>
                <input id="returnbutton" type="button" value="Return"></input><br>
            </form>
        </div>
    </div>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io(`http://18.217.107.58:3000`)
        //HTML chatbox and textbox and return button
        let chatbox = document.getElementById('chatbox');
        let text = document.getElementById('text');
        let returnbutton = document.getElementById('returnbutton');
        returnbutton.addEventListener('click', event => {
            send_message(text.value);
            text.value = '';
        })

        text.addEventListener('keypress', event => {
            if (event.keyCode === 13) {
                event.preventDefault();
                send_message(text.value);
                text.value = '';
            }
        })

        //HTML participants box
        const participantsbox = document.getElementById('participants');
        const playerselect = document.getElementById('player-select');
        const eventlog = document.getElementById('eventlog');
        
        //socket client programming
        const name = prompt('Enter username: ')
        socket.emit('new-user', name);
        //console.log(`${name} joined.`)
        chatbox.value += `${name} joined.\n`;

        //receiving new connection message
        socket.on('user-connected', name => {
            //console.log(`${name} joined.`);
            chatbox.value += `${name} joined.\n`;
        })

        //receiving a chat-message
        socket.on('chat-message', data => {
            //console.log(`${data.name}: ${data.message}`);
            chatbox.value += `${data.name}: ${data.message}\n`;
        })

        //sending a chat-message
        function send_message(message = 'sample message') {
            socket.emit('send-chat-message', message);
            //console.log(`${name}: ${message}`);
            chatbox.value += `${name}: ${message}\n`;
        }

        //receiving disconnection message
        socket.on('user-disconnected', name => {
            //console.log(`${name} left.`);
            chatbox.value += `${name} left.\n`;
        })

        //recieving a list of participants
        //update participansbox and playerselect
        socket.on('participants', participants => {
            let str = '';
            for (const participant of participants) {
                str += `<option>${participant}</option>`;
            }
            playerselect.innerHTML = str;
            participantsbox.value = participants.join('\n');
        })

        

        //triggered on clicking "Leave" or "Stay" buttons.
        function button_day(option = 'stay') {
            socket.emit('button-day', option);
        }

        //triggered on clicking "Proceed" button.
        function button_proceed() {
            socket.emit('button-proceed', null);
        }

        //triggered on clicking "Stay Awake", "Stab", or "Tape" buttons.
        function button_night(option) {
            socket.emit('button-night', {option: option, target: playerselect.value});
        }

        //receiving game event message
        socket.on('game-event', message => {
            //console.log(message);
            eventlog.value += `${message}\n`;
        })

    </script>
</body>
</html>