<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="description" content="homepage">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>summer 2020</title>
    <style>
      .canvasframe {
        float: left;
        width: 620px;
      }
      .chatframe {
        float: right;
        width: 350px;
      }
      .row:after {
        content: "";
        display: table;
        clear: both;
      }
    </style>
</head>
<body>
    <div class='row'>
        <div class="canvasframe">
            <label>Event Log</label>
            <canvas height='500px' width='800px' style="border: 1pt solid black;"></canvas>
            <div class="day-options">
                <form>
                    <label>Day</label><br>
                    <input id="day-leave" type="button" value="Leave"></input>
                    <input id="day-stay" type="button" value="Stay"></input>
                    <br>
                    <input id="day-proceed" type="button" value="Proceed to Night"></input>
                </form>
            </div>
            <br>
            <div class="night-options">
                <form>
                    <label>Night</label><br>
                    <input id="night-stay_awake" type="button" value="Stay Awake"></input>
                    <br>
                    <input id="night-stab" type="button" value="Stab"></input>
                    <input id="night-tape" type="button" value="Tape"></input>
                    <select id="player-select" name="number">
                        <option value='2'>Alice</option>
                        <option value='3'>Bob</option>
                        <option value='4'>Charlie</option>
                        <option value='5'>Dave</option>
                      </select>
                </form>
            </div>
        </div>
        <div class="chatframe">
            <form>
                <label>Participants</label><br>
                <textarea id="participants" rows="10" cols="50" disabled></textarea><br>
                <label>Chat</label><br>
                <textarea id="chatbox" rows="31" cols="50" disabled></textarea><br>
                <input type="text" id="text" size="43"></input>
                <input id="returnbutton" type="button" value="Return"></input><br>
            </form>
        </div>
    </div>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io(`http://18.217.107.58:3000`)
        //HTML chatbox and textbox and return button
        let chatbox = document.getElementById('chatbox');
        let text = document.getElementById('text');
        let returnbutton = document.getElementById('returnbutton');
        returnbutton.addEventListener('click', event => {
            send_message(text.value);
            text.value = '';
        })

        text.addEventListener('keypress', event => {
            if (event.keyCode === 13) {
                event.preventDefault();
                send_message(text.value);
                text.value = '';
            }
        })

        //HTML participants box
        let participantsbox = document.getElementById('participants')
        
        //socket client programming
        const name = prompt('Enter username: ')
        socket.emit('new-user', name)
        console.log(`${name} joined.`)
        chatbox.value += `${name} joined.\n`;

        //receiving new connection message
        socket.on('user-connected', name => {
            console.log(`${name} joined.`);
            chatbox.value += `${name} joined.\n`;
        })

        //receiving a chat-message
        socket.on('chat-message', data => {
            console.log(`${data.name}: ${data.message}`);
            chatbox.value += `${data.name}: ${data.message}\n`
        })

        //sending a chat-message
        function send_message(message = 'sample message') {
            socket.emit('send-chat-message', message);
            console.log(`${name}: ${message}`);
            chatbox.value += `${name}: ${message}\n`
        }

        //receiving disconnection message
        socket.on('user-disconnected', name => {
            console.log(`${name} left.`);
            chatbox.value += `${name} left.\n`
        })

        //recieving a list of participants
        socket.on('participants', participants => {
            participantsbox.value = participants.join('\n');
        })
    </script>
</body>
</html>